public static class Scripts
{
    public static string AssetsCs = "using System.Collections.Generic;\nusing System.IO;\nusing Avalonia.Media.Imaging;\nusing QEngine.GUI;\n\npublic static class Assets\n{\n    public static string assetsPath => Path.Combine(Directory.GetCurrentDirectory(), \"Assets\");\n    static Dictionary<(string, int), Sprite> _sprites = new();\n\n    public static Sprite ReadImage(string path, int scale = 1)\n    {\n        path = Path.Combine(assetsPath, path.Replace(\"\\\\\", \"/\"));\n        if (_sprites.TryGetValue((path, scale), out Sprite sprite))\n            return sprite;\n        \n        using var stream = File.OpenRead(path);\n        var bitmap = new Bitmap(stream);\n\n        sprite = new Sprite(bitmap,  scale);\n        _sprites[(path,scale)] = sprite;\n        \n        return sprite;\n    }\n}";

    public static string CoreCs = "using System.Collections.Generic;\nusing Avalonia;\nusing QEngine;\n\ninternal class GameCore\n{\n    public static void Main(string[] args)\n    => BuildAvaloniaApp()\n        .StartWithClassicDesktopLifetime(args);\n    \n    public static AppBuilder BuildAvaloniaApp()\n        => AppBuilder.Configure<App>()\n            .UsePlatformDetect()\n            .LogToTrace();\n}\n\npublic static class Game\n{\n    public static string title = \"QEngine Game\";\n    public static Vector2Int size = new(1280, 720);\n}\npublic static class SceneManager\n{\n    static Dictionary<string, QEScene> scenes = new();\n    public static QEScene? actualScene = null;\n    \n    public static void AddScene(string name, QEScene scene)\n    {\n        scene.Name = name;\n        if (!scenes.ContainsKey(name))\n            scenes.Add(name, scene);\n    }\n    public static void GoToScene(string name) { if (scenes.TryGetValue(name, out var scene)) { actualScene = scene; actualScene.Init(); } }\n}";
    
    public static string QEngineCs = "using System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing Avalonia;\nusing Avalonia.Media;\nusing Avalonia.Media.Imaging;\n\nnamespace QEngine\n{\n    #region Variables\n    public class Vector2\n    {\n        public float x, y;\n        public Vector2(float x = 0, float y = 0) { this.x = x; this.y = y; }\n        \n        public static Vector2 operator +(Vector2 a, Vector2 b)\n            => new(a.x + b.x, a.y + b.y);\n        \n        public static Vector2 operator -(Vector2 a, Vector2 b)\n            => new(a.x - b.x, a.y - b.y);\n        \n        public static Vector2 operator *(Vector2 a, Vector2 b)\n            => new(a.x * b.x, a.y * b.y);\n        public static Vector2 operator *(Vector2 a, float b)\n            => new(a.x * b, a.y * b);\n        \n        public static Vector2 operator /(Vector2 a, Vector2 b)\n            => new(a.x / b.x, a.y / b.y);\n        public static Vector2 operator /(Vector2 a, float b)\n            => new(a.x / b, a.y / b);\n    }\n    public class Vector2Int\n    {\n        public int x, y;\n        public Vector2Int(int x = 0, int y = 0) { this.x = x; this.y = y; }\n        \n        public static Vector2Int operator +(Vector2Int a, Vector2Int b)\n            => new(a.x + b.x, a.y + b.y);\n        \n        public static Vector2Int operator -(Vector2Int a, Vector2Int b)\n            => new(a.x - b.x, a.y - b.y);\n        \n        public static Vector2Int operator *(Vector2Int a, Vector2Int b)\n            => new(a.x * b.x, a.y * b.y);\n        public static Vector2Int operator *(Vector2Int a, int b)\n            => new(a.x * b, a.y * b);\n    }\n    public class Transform\n    {\n        public Vector2 position = new();\n        public float rotation = 0;\n        public Vector2 scale = new(1, 1);\n    }\n    #endregion\n    \n    #region Global\n    public class QEScene\n    {\n        public string Name = \"\";\n        readonly List<GameObject> _objects = new();\n        \n        public GameObject CreateObject(string name = \"GameObject\") { GameObject go = new(name); _objects.Add(go); return go; }\n        public List<GameObject> getObjects() => _objects;\n        \n        public virtual void Init() {}\n        public void Update() { foreach (var obj in _objects) obj.Update(); }\n    }\n    public sealed class GameObject\n    {\n        public string Name = \"\";\n        public Transform transform = new();\n        readonly List<Component> _components = new();\n        \n        public GameObject(string name = \"\") => Name = name;\n        \n        public T AddComponent<T>() where T : Component, new()\n        {\n            var c = new T { gameObject = this };\n            _components.Add(c);\n            c.Init();\n            return c;\n        }\n\n        public T? GetComponent<T>() where T : Component\n            => _components.OfType<T>().FirstOrDefault();\n\n        public bool TryGetComponent<T>(out T component) where T : Component\n        {\n            foreach (var c in _components) { if (c is T t) { component = t; return true; } }\n            component = null!;\n            return false;\n        }\n        \n        internal void Update() { foreach (var c in _components) c.Update(); }\n    }\n    public class Component\n    {\n        public GameObject gameObject { get; internal set; } = null;\n        public virtual void Init() {}\n        public virtual void Update() {}\n    }\n    public class QEScript : Component { }\n    #endregion\n}\n\nnamespace QEngine.GUI\n{\n    #region Components\n\n    public class Image : Component\n    {\n        public Vector2 size = new(100, 100);\n        public Sprite sprite = null;\n        public Color color = new(255);\n    }\n    #endregion\n    \n    #region Variables\n    public class Color\n    {\n        public byte r, g, b, a;\n        public SolidColorBrush _clr;\n\n        public Color(byte rgb, byte a = 255)\n        {\n            r = rgb; g = rgb; b = rgb; this.a = a; \n            _clr = new(new Avalonia.Media.Color(a, rgb, rgb, rgb));\n        }\n\n        public Color(byte r, byte g, byte b, byte a = 255)\n        {\n            this.r = r; this.g = g; this.b = b; this.a = a;\n            _clr = new(new Avalonia.Media.Color(a, r, g, b));\n        } \n    }\n    public sealed class Sprite\n    {\n        public Bitmap Bitmap { get; }\n\n        public int Width => Bitmap.PixelSize.Width;\n        public int Height => Bitmap.PixelSize.Height;\n\n        internal Sprite(Bitmap bitmap, int scale = 1)\n        {\n            if (scale <= 0)\n                throw new ArgumentOutOfRangeException(nameof(scale));\n\n            Bitmap = scale == 1\n                ? bitmap\n                : bitmap.CreateScaledBitmap(\n                    new PixelSize(\n                        bitmap.PixelSize.Width * scale,\n                        bitmap.PixelSize.Height * scale\n                    ),\n                    BitmapInterpolationMode.None\n                );\n        }\n    }\n    #endregion\n}\n\nnamespace QEngine.Input\n{\n    public enum Key\n    {\n        None,\n        A, B, C, D, E, F, G, H, I, J, K, L, M, \n        N, O, P, Q, R, S, T, U, V, W, X, Y, Z,\n        \n        D1, D2, D3, D4, D5, D6, D7, D8, D9, D0,\n        \n        NumPad0, NumPad1, NumPad2, NumPad3, NumPad4, \n        NumPad5, NumPad6, NumPad7, NumPad8, NumPad9,\n        NumPadAdd, NumPadSubstract, NumPadMultiply, NumPadDivide,\n        NumPadDecimal, NumPadEnter,\n        \n        Tilde,          // `\n        Minus,          // -\n        Plus,           // =\n        BracketLeft,    // [\n        BracketRight,   // ]\n        Backslash,      // \\\n        Semicolon,      // ;\n        Quote,          // '\n        Comma,          // ,\n        Period,         // .\n        Slash,          // /\n        \n        Escape,\n        Tab,\n        CapsLock,\n        ShiftLeft,\n        ShiftRight,\n        ControlLeft,\n        ControlRight,\n        AltLeft,\n        AltRight,\n        Space,\n        Enter,\n        Backspace,\n        \n        Up,\n        Down,\n        Left,\n        Right,\n        \n        F1, F2, F3, F4, F5, F6,\n        F7, F8, F9, F10, F11, F12,\n        \n        Insert,\n        Delete,\n        Home,\n        End,\n        PageUp,\n        PageDown\n    }\n    \n    public static class Input\n    {\n        static Dictionary<Key, bool> keys = new();\n\n        static Input()\n        {\n            keys = new Dictionary<Key, bool>();\n            foreach (Key k in Enum.GetValues(typeof(Key)))\n                keys[k] = false;\n        }\n\n        public static bool Read(Key key) => keys[key];\n\n        internal static void SetKeyDown(Key key) => keys[key] = true;\n        internal static void SetKeyUp(Key key) => keys[key] = false;\n    }\n    \n    internal static class KeyMapper\n    {\n        private static readonly Dictionary<Avalonia.Input.Key, Key> _manual = new()\n        {\n            { Avalonia.Input.Key.Oem3, Key.Tilde },\n            { Avalonia.Input.Key.OemMinus, Key.Minus },\n            { Avalonia.Input.Key.OemPlus, Key.Plus },\n            { Avalonia.Input.Key.Oem4, Key.BracketLeft },\n            { Avalonia.Input.Key.Oem6, Key.BracketRight },\n            { Avalonia.Input.Key.Oem5, Key.Backslash },\n            { Avalonia.Input.Key.Oem1, Key.Semicolon },\n            { Avalonia.Input.Key.Oem7, Key.Quote },\n            { Avalonia.Input.Key.OemComma, Key.Comma },\n            { Avalonia.Input.Key.OemPeriod, Key.Period },\n            { Avalonia.Input.Key.Oem2, Key.Slash },\n        };\n\n        public static bool TryMap(Avalonia.Input.Key aKey, out Key key)\n        {\n            if (_manual.TryGetValue(aKey, out key))\n                return true;\n\n            return Enum.TryParse(aKey.ToString(), out key);\n        }\n    }\n}\n";
    
    public static string RendererCs = "using System;\nusing Avalonia;\nusing Avalonia.Controls;\nusing Avalonia.Controls.ApplicationLifetimes;\nusing Avalonia.Input;\nusing Avalonia.Threading;\nusing Avalonia.Media;\nusing QEngine;\nusing QEngine.Input;\nusing Image = QEngine.GUI.Image;\n\npublic sealed class GameWindow : Window\n{\n    private readonly GameView _view;\n\n    public GameWindow()\n    {\n        Width = Game.size.x;\n        Height = Game.size.y;\n        Title = Game.title;\n        \n        KeyDown += OnKeyDown;\n        KeyUp += OnKeyUp;\n        \n        _view = new GameView();\n        Content = _view;\n\n        StartGameLoop();\n    }\n\n    protected override void OnResized(WindowResizedEventArgs e)\n    {\n        Game.size = new((int)e.ClientSize.Width, (int)e.ClientSize.Height);\n        base.OnResized(e);\n    }\n\n    private void OnKeyDown(object? sender, KeyEventArgs e)\n    {\n        if (KeyMapper.TryMap(e.Key, out var key))\n            Input.SetKeyDown(key);\n    }\n    private void OnKeyUp(object? sender, KeyEventArgs e)\n    {\n        if (KeyMapper.TryMap(e.Key, out var key))\n            Input.SetKeyUp(key);\n    }\n    private void StartGameLoop()\n    {\n        var timer = new DispatcherTimer { Interval = TimeSpan.FromMilliseconds(16) };\n\n        timer.Tick += (_, _) =>\n        {\n            _view.Update();\n            _view.InvalidateVisual();\n        };\n\n        timer.Start();\n    }\n}\n\npublic sealed class GameView : Control\n{\n    public void Update() { SceneManager.actualScene?.Update(); }\n\n    public override void Render(DrawingContext ctx)\n    {\n        ctx.FillRectangle(Brushes.Black, Bounds);\n        if (SceneManager.actualScene == null)\n            return;\n        base.Render(ctx);\n\n        foreach (var obj in SceneManager.actualScene.getObjects())\n        {\n            if (obj.TryGetComponent(out Image img))\n            { \n                Vector2 pos = new(obj.transform.position.x + Game.size.x / 2, obj.transform.position.y + Game.size.y / 2);\n                if (img.sprite != null)\n                {\n                    ctx.DrawImage(\n                        img.sprite.Bitmap,\n                        new Rect(0, 0, img.sprite.Width, img.sprite.Height), // SOURCE\n                        new Rect(\n                            pos.x - img.sprite.Width / 2 * obj.transform.scale.x,\n                            pos.y - img.sprite.Height / 2 * obj.transform.scale.y,\n                            img.sprite.Width * obj.transform.scale.x,\n                            img.sprite.Height * obj.transform.scale.y\n                        )\n                    );\n                    //ctx.FillRectangle(color, new Rect(obj.transform.position.x, obj.transform.position.y, img.sprite.Width, img.sprite.Height));\n                }\n                else { ctx.FillRectangle(img.color._clr,\n                    new Rect(pos.x - img.size.x / 2, pos.y - img.size.y / 2, img.size.x, img.size.y)); }\n            }\n        }\n    }\n}\n\npublic class App : Application\n{\n    public override void OnFrameworkInitializationCompleted()\n    {\n        if (ApplicationLifetime is IClassicDesktopStyleApplicationLifetime desktop)\n        {\n            SceneManager.AddScene(\"Main\", new MainScene());\n            SceneManager.GoToScene(\"Main\");\n            \n            desktop.MainWindow = new GameWindow();\n        }\n        base.OnFrameworkInitializationCompleted();\n    }\n}";
}